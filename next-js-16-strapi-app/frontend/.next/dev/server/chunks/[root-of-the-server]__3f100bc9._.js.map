{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/lib/strapi.ts"],"sourcesContent":["import qs from 'qs';\r\nimport { cacheLife } from 'next/cache';\r\n\r\nexport const STRAPI_BASE_URL = process.env.STRAPI_BASE_URL || 'http://127.0.0.1:1337';\r\n\r\nconst QUERY_HOME_PAGE = {\r\n    populate: {\r\n        sections: {\r\n            on: {\r\n                'layout.hero-section': {\r\n                    populate: {\r\n                        image: {\r\n                            fields: ['url', 'alternativeText']\r\n                        },\r\n                        link: {\r\n                            populate: true\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport async function getHomePage() {\r\n    'use cache'\r\n\r\n    cacheLife({ expire: 60}); // 1 minute\r\n\r\n    const query = qs.stringify(QUERY_HOME_PAGE);\r\n    const response = await getStrapiData(`/api/home-page?${query}`);\r\n    return response?.data;\r\n}\r\n\r\nexport async function getStrapiData(url: string) {\r\n    try {\r\n        const response = await fetch(`${STRAPI_BASE_URL}${url}`);\r\n        if (!response.ok) {\r\n            throw new Error(`HTTP error! Status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error('Error fetching data from Strapi:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function registerUserService(userData: object) {\r\n    const url = `${STRAPI_BASE_URL}/api/auth/local/register`;\r\n\r\n    try {\r\n        const response = await fetch(url, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(userData),\r\n        })\r\n\r\n        const data = await response.json();\r\n        console.log(data)\r\n        return data;\r\n    } catch (error) {\r\n        console.error('Error registering user:', error);\r\n        throw error;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEO,MAAM,kBAAkB,QAAQ,GAAG,CAAC,eAAe,IAAI;AAE9D,MAAM,kBAAkB;IACpB,UAAU;QACN,UAAU;YACN,IAAI;gBACA,uBAAuB;oBACnB,UAAU;wBACN,OAAO;4BACH,QAAQ;gCAAC;gCAAO;6BAAkB;wBACtC;wBACA,MAAM;4BACF,UAAU;wBACd;oBACJ;gBACJ;YACJ;QACJ;IACJ;AACJ;AAEO,eAAe;IAClB;IAEA,IAAA,0IAAS,EAAC;QAAE,QAAQ;IAAE,IAAI,WAAW;IAErC,MAAM,QAAQ,6IAAE,CAAC,SAAS,CAAC;IAC3B,MAAM,WAAW,MAAM,cAAc,CAAC,eAAe,EAAE,OAAO;IAC9D,OAAO,UAAU;AACrB;AAEO,eAAe,cAAc,GAAW;IAC3C,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,GAAG,kBAAkB,KAAK;QACvD,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;QAC5D;QACA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,MAAM;IACV;AACJ;AAEO,eAAe,oBAAoB,QAAgB;IACtD,MAAM,MAAM,GAAG,gBAAgB,wBAAwB,CAAC;IAExD,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,KAAK;YAC9B,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;QACzB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC;QACZ,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACV;AACJ","debugId":null}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/proxy.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\nimport { STRAPI_BASE_URL } from \"./lib/strapi\"\r\n\r\nconst protectedRoutes = ['/dashboard']\r\n\r\nfunction cheskIsProtectedRoute(pathname: string) {\r\n    // .some is used to check if any of the protected routes starts with the pathname\r\n    // (route => pathname.startsWith(route)) is a callback function that checks if the pathname starts with the route\r\n    return protectedRoutes.some(route => pathname.startsWith(route))\r\n    // you can also use 'return protectedRoutes.includes(pathname)' for a single path check\r\n}\r\n\r\nexport async function proxy(request: NextRequest) {\r\n    const currentPath = request.nextUrl.pathname\r\n\r\n    const isProtectedRoute = cheskIsProtectedRoute(currentPath)\r\n\r\n    // NextResponse.next() is used to continue the request and return the response\r\n    // so this is used to continue the request if the route is not protected\r\n    if (!isProtectedRoute) return NextResponse.next()\r\n\r\n    // if the route is protected, we need to verify is the user is authenticated\r\n    try {\r\n        const cookieStore = await cookies()\r\n        const jwt = cookieStore.get('jwt')?.value\r\n\r\n        if (!jwt) {\r\n            // if the user is not authenticated, we need to redirect to the login page\r\n            return NextResponse.redirect(new URL('/signin', request.url))\r\n        }\r\n\r\n        const response = await fetch(`${STRAPI_BASE_URL}/api/users/me`, {\r\n            headers: {\r\n                'Authorization': `Bearer ${jwt}`,\r\n                'Content-Type': 'application/json',\r\n            }\r\n        })\r\n        const userResponse = await response.json()\r\n        console.log(userResponse);\r\n        \r\n        if (!userResponse) {\r\n            // if the user is not authenticated, we need to redirect to the login page\r\n            return NextResponse.redirect(new URL('/signin', request.url))\r\n        }\r\n\r\n        // if the user is authenticated, we need to continue the request\r\n        return NextResponse.next()\r\n\r\n    } catch (error) {\r\n        console.log('Error verifying user authentication:', error)\r\n        // if the user is not authenticated, we need to redirect to the login page\r\n        return NextResponse.redirect(new URL('/signin', request.url))\r\n    }\r\n}\r\n\r\n// this is used to match all routes except the ones that start with api, _next/static, _next/image, and favicon.ico\r\n// and also the dashboard route and all routes that start with /dashboard\r\nexport const config = {\r\n    matcher: [\r\n        \"/((?!api|_next/static|_next/image|favicon.ico).*)\", // to match all routes except the ones that start with api, _next/static, _next/image, and favicon.ico\r\n        \"/dashboard\", // to match the dashboard route\r\n        \"/dashboard/:path*\" // to match all routes that start with /dashboard\r\n    ]\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,kBAAkB;IAAC;CAAa;AAEtC,SAAS,sBAAsB,QAAgB;IAC3C,iFAAiF;IACjF,iHAAiH;IACjH,OAAO,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;AACzD,uFAAuF;AAC3F;AAEO,eAAe,MAAM,OAAoB;IAC5C,MAAM,cAAc,QAAQ,OAAO,CAAC,QAAQ;IAE5C,MAAM,mBAAmB,sBAAsB;IAE/C,8EAA8E;IAC9E,wEAAwE;IACxE,IAAI,CAAC,kBAAkB,OAAO,8IAAY,CAAC,IAAI;IAE/C,4EAA4E;IAC5E,IAAI;QACA,MAAM,cAAc,MAAM,IAAA,0IAAO;QACjC,MAAM,MAAM,YAAY,GAAG,CAAC,QAAQ;QAEpC,IAAI,CAAC,KAAK;YACN,0EAA0E;YAC1E,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,WAAW,QAAQ,GAAG;QAC/D;QAEA,MAAM,WAAW,MAAM,MAAM,GAAG,gIAAe,CAAC,aAAa,CAAC,EAAE;YAC5D,SAAS;gBACL,iBAAiB,CAAC,OAAO,EAAE,KAAK;gBAChC,gBAAgB;YACpB;QACJ;QACA,MAAM,eAAe,MAAM,SAAS,IAAI;QACxC,QAAQ,GAAG,CAAC;QAEZ,IAAI,CAAC,cAAc;YACf,0EAA0E;YAC1E,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,WAAW,QAAQ,GAAG;QAC/D;QAEA,gEAAgE;QAChE,OAAO,8IAAY,CAAC,IAAI;IAE5B,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC,wCAAwC;QACpD,0EAA0E;QAC1E,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,WAAW,QAAQ,GAAG;IAC/D;AACJ;AAIO,MAAM,SAAS;IAClB,SAAS;QACL;QACA;QACA,oBAAoB,iDAAiD;KACxE;AACL","debugId":null}}]
}