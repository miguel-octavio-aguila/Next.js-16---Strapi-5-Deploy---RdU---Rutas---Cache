{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/lib/strapi.ts"],"sourcesContent":["// frontend/lib/strapi.ts\r\n\r\nimport qs from \"qs\";\r\n// 1. ELIMINA las importaciones de 'next/cache'\r\n// import { cacheLife } from 'next/cache';\r\n\r\n// 2. AÑADE la importación de 'cache' de 'react'\r\nimport { cache } from \"react\";\r\n\r\nexport const STRAPI_BASE_URL =\r\n    process.env.STRAPI_BASE_URL || \"http://127.0.0.1:1337\";\r\n\r\nconst QUERY_HOME_PAGE = {\r\n    populate: {\r\n        sections: {\r\n        on: {\r\n            \"layout.hero-section\": {\r\n            populate: {\r\n                image: {\r\n                fields: [\"url\", \"alternativeText\"],\r\n                },\r\n                link: {\r\n                populate: true,\r\n                },\r\n            },\r\n            },\r\n        },\r\n        },\r\n    },\r\n};\r\n\r\n// 3. ENVUELVE tu función 'getHomePage' con la función 'cache()'\r\nexport const getHomePage = cache(async () => {\r\n  // 4. ELIMINA las directivas experimentales\r\n  // 'use cache'\r\n  // cacheLife({ expire: 60}); // 1 minute\r\n\r\n    const query = qs.stringify(QUERY_HOME_PAGE);\r\n    const response = await getStrapiData(`/api/home-page?${query}`);\r\n    return response?.data;\r\n});\r\n\r\nexport async function getStrapiData(url: string) {\r\n    try {\r\n        const response = await fetch(`${STRAPI_BASE_URL}${url}`);\r\n        if (!response.ok) {\r\n        throw new Error(`HTTP error! Status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error(\"Error fetching data from Strapi:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function registerUserService(userData: object) {\r\n    const url = `${STRAPI_BASE_URL}/api/auth/local/register`;\r\n\r\n    try {\r\n        const response = await fetch(url, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(userData),\r\n        });\r\n\r\n        const data = await response.json();\r\n        console.log(data);\r\n        return data;\r\n    } catch (error) {\r\n        console.error(\"Error registering user:\", error);\r\n        throw error;\r\n    }\r\n}"],"names":[],"mappings":"AAAA,yBAAyB;;;;;;;;;;;AAEzB;AACA,+CAA+C;AAC/C,0CAA0C;AAE1C,gDAAgD;AAChD;;;AAEO,MAAM,kBACT,QAAQ,GAAG,CAAC,eAAe,IAAI;AAEnC,MAAM,kBAAkB;IACpB,UAAU;QACN,UAAU;YACV,IAAI;gBACA,uBAAuB;oBACvB,UAAU;wBACN,OAAO;4BACP,QAAQ;gCAAC;gCAAO;6BAAkB;wBAClC;wBACA,MAAM;4BACN,UAAU;wBACV;oBACJ;gBACA;YACJ;QACA;IACJ;AACJ;AAGO,MAAM,cAAc,IAAA,8MAAK,EAAC;IAC/B,2CAA2C;IAC3C,cAAc;IACd,wCAAwC;IAEtC,MAAM,QAAQ,6IAAE,CAAC,SAAS,CAAC;IAC3B,MAAM,WAAW,MAAM,cAAc,CAAC,eAAe,EAAE,OAAO;IAC9D,OAAO,UAAU;AACrB;AAEO,eAAe,cAAc,GAAW;IAC3C,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,GAAG,kBAAkB,KAAK;QACvD,IAAI,CAAC,SAAS,EAAE,EAAE;YAClB,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;QACxD;QACA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,MAAM;IACV;AACJ;AAEO,eAAe,oBAAoB,QAAgB;IACtD,MAAM,MAAM,GAAG,gBAAgB,wBAAwB,CAAC;IAExD,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,KAAK;YAClC,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;QACrB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC;QACZ,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACV;AACJ","debugId":null}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/validations/auth.ts"],"sourcesContent":["import { z } from \"zod\";\r\n\r\nexport const SigninFormSchema = z.object({\r\n    identifier: z\r\n        .string()\r\n        .min(3, \"Username or email must be at least 3 characters long\"),\r\n    password: z\r\n        .string()\r\n        .min(6, \"Password must be at least 6 characters long\")\r\n        .max(100, \"Password must be less than 100 characters long\"),\r\n});\r\n\r\nexport const SignupFormSchema = z.object({\r\n    username: z\r\n        .string()\r\n        .min(3, \"Username must be at least 3 characters long\")\r\n        .max(20, \"Username must be less than 20 characters long\"),\r\n    email: z\r\n        .email(\"Email must be a valid email address\"),\r\n    password: z\r\n        .string()\r\n        .min(6, \"Password must be at least 6 characters long\")\r\n        .max(100, \"Password must be less than 100 characters long\"),\r\n});\r\n\r\nexport type SigninFormValues = z.infer<typeof SigninFormSchema>;\r\nexport type SignupFormValues = z.infer<typeof SignupFormSchema>;\r\n\r\nexport type FormState = {\r\n    success?: boolean;\r\n    message?: string;\r\n    data?: {\r\n        identifier?: string;\r\n        password?: string;\r\n        username?: string;\r\n        email?: string;    \r\n    };\r\n    // stapiErrors and zodErrors is for education content but in a real project you should name them\r\n    // in a different way to avoid clues about what you are using in the frontend\r\n    strapiErrors?: {\r\n        status: number;\r\n        name: string;\r\n        message: string;\r\n        details?: Record<string, string[]>;\r\n    } | null;\r\n    zodErrors?: {\r\n        identifier?: string[];\r\n        password?: string[];\r\n        username?: string[];\r\n        email?: string[];\r\n    } | null;\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,mBAAmB,kLAAC,CAAC,MAAM,CAAC;IACrC,YAAY,kLAAC,CACR,MAAM,GACN,GAAG,CAAC,GAAG;IACZ,UAAU,kLAAC,CACN,MAAM,GACN,GAAG,CAAC,GAAG,+CACP,GAAG,CAAC,KAAK;AAClB;AAEO,MAAM,mBAAmB,kLAAC,CAAC,MAAM,CAAC;IACrC,UAAU,kLAAC,CACN,MAAM,GACN,GAAG,CAAC,GAAG,+CACP,GAAG,CAAC,IAAI;IACb,OAAO,kLAAC,CACH,KAAK,CAAC;IACX,UAAU,kLAAC,CACN,MAAM,GACN,GAAG,CAAC,GAAG,+CACP,GAAG,CAAC,KAAK;AAClB","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/actions/auth.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { registerUserService } from \"@/lib/strapi\";\r\nimport { SignupFormSchema, type FormState } from \"@/validations/auth\";\r\n\r\nimport { z } from \"zod\";\r\nimport { cookies } from \"next/headers\";\r\nimport { redirect } from \"next/navigation\";\r\n\r\nconst cookieConfig = {\r\n    maxAge: 60 * 60 * 24 * 7, // 7 days\r\n    path: '/',\r\n    httpOnly: true, // only accessible in the server side\r\n    domain: process.env.HOST ?? 'localhost',\r\n    secure: process.env.NODE_ENV === 'production', // use https for security\r\n}\r\n\r\n// use server is not display in the console because actions are run on the server\r\n// actions are run on the server side\r\nexport async function registerUserAction(prevState: FormState , formData: FormData): Promise<FormState> {\r\n    const fields = {\r\n        username: formData.get(\"username\") as string,\r\n        email: formData.get(\"email\") as string,\r\n        password: formData.get(\"password\") as string,\r\n    }\r\n\r\n    // validations occur in the server side, in the backend\r\n    const validatedFields = SignupFormSchema.safeParse(fields);\r\n\r\n    if (!validatedFields.success) {\r\n        const flattenedErrors = z.flattenError(validatedFields.error)\r\n\r\n        console.log('Validation errors:', flattenedErrors.fieldErrors)\r\n\r\n        return {\r\n            success: false,\r\n            message: \"Validation errors\",\r\n            strapiErrors: null,\r\n            zodErrors: flattenedErrors.fieldErrors,\r\n            data: {\r\n                // prev data of the state\r\n                ...prevState.data,\r\n                // new data of the state\r\n                ...fields,\r\n            }\r\n        }\r\n    }\r\n\r\n    const response = await registerUserService(validatedFields.data)\r\n\r\n    if (!response || response.error) {\r\n        return {\r\n            success: false,\r\n            message: \"Registration errors\",\r\n            strapiErrors: response.error,\r\n            zodErrors: null,\r\n            data: {\r\n                // prev data of the state\r\n                ...prevState.data,\r\n                // new data of the state\r\n                ...fields,\r\n            }\r\n        }\r\n    }\r\n\r\n    // JWT token is stored in a cookie\r\n    const cookieStore = await cookies()\r\n    cookieStore.set('jwt', response.jwt, cookieConfig)\r\n    redirect('/dashboard')\r\n\r\n    /*\r\n    console.log('Registration successful')\r\n\r\n    return {\r\n        success: true,\r\n        message: \"Registration succesful\",\r\n        strapiErrors: null,\r\n        zodErrors: null,\r\n        data: {\r\n            // prev data of the state\r\n            ...prevState.data,\r\n            // new data of the state\r\n            ...fields,\r\n        }\r\n    }\r\n    */\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;AAEA,MAAM,eAAe;IACjB,QAAQ,KAAK,KAAK,KAAK;IACvB,MAAM;IACN,UAAU;IACV,QAAQ,QAAQ,GAAG,CAAC,IAAI,IAAI;IAC5B,QAAQ,oDAAyB;AACrC;AAIO,eAAe,mBAAmB,SAAoB,EAAG,QAAkB;IAC9E,MAAM,SAAS;QACX,UAAU,SAAS,GAAG,CAAC;QACvB,OAAO,SAAS,GAAG,CAAC;QACpB,UAAU,SAAS,GAAG,CAAC;IAC3B;IAEA,uDAAuD;IACvD,MAAM,kBAAkB,uIAAgB,CAAC,SAAS,CAAC;IAEnD,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAC1B,MAAM,kBAAkB,kLAAC,CAAC,YAAY,CAAC,gBAAgB,KAAK;QAE5D,QAAQ,GAAG,CAAC,sBAAsB,gBAAgB,WAAW;QAE7D,OAAO;YACH,SAAS;YACT,SAAS;YACT,cAAc;YACd,WAAW,gBAAgB,WAAW;YACtC,MAAM;gBACF,yBAAyB;gBACzB,GAAG,UAAU,IAAI;gBACjB,wBAAwB;gBACxB,GAAG,MAAM;YACb;QACJ;IACJ;IAEA,MAAM,WAAW,MAAM,IAAA,oIAAmB,EAAC,gBAAgB,IAAI;IAE/D,IAAI,CAAC,YAAY,SAAS,KAAK,EAAE;QAC7B,OAAO;YACH,SAAS;YACT,SAAS;YACT,cAAc,SAAS,KAAK;YAC5B,WAAW;YACX,MAAM;gBACF,yBAAyB;gBACzB,GAAG,UAAU,IAAI;gBACjB,wBAAwB;gBACxB,GAAG,MAAM;YACb;QACJ;IACJ;IAEA,kCAAkC;IAClC,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,OAAO,SAAS,GAAG,EAAE;IACrC,IAAA,iMAAQ,EAAC;AAET;;;;;;;;;;;;;;;IAeA,GACJ;;;IAnEsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Miguel%20Aguila/Documents/Cursos/Programaci%C3%B3n/Next.js%2016%20%2B%20Strapi%205%20Deploy%20%2B%20RdU%20%2B%20Rutas%20%2B%20Cache/next-js-16-strapi-app/frontend/.next-internal/server/app/%28auth%29/signup/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {registerUserAction as '60e125803879b8655dbf71b7b2f3213b50cbf0d346'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}